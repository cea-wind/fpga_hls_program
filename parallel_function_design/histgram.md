# 直方图统计

## 1. 概述



## 2. 流水线设计中的数据依赖

如果简单的针对串行代码增加`PIPELINE` ，会发现综合结果并没有达到预期。进一步分析会发现，使得`II>1` 的原因是计算过程中针对数组`local_hist` 的读写操作存在数据依赖关系，这是一个在之前的所有例子中都没有遇到过的问题。

实际上，由于`local_hist` 是一个长度为1024的数组，在硬件实现过程中被映射成了**SRAM**。对于长度为1024的数组而言，如果采用寄存器实现，那么当需要对数组进行随机寻址时，需要进行一次1024选1的操作，这一操作的计算复杂度极高。除此之外，在进行直方图统计的过程中，一次迭代只需要访问数组中的一个元素，并不需要提供1024个寄存器同时访问的能力，而SRAM的硬件结构很适合这种应用。Xilinx的FPGA中的BRAM（Block RAM）是一种很适合存储1024长度向量的SRAM，和寄存器不同，一般而言BRAM需要1个时钟周期才能完成数据读取的过程。此时，迭代过程中的计算示意图如下。



在一次迭代内部，存在着先写后读（Read After Write, RAW）的数据依赖关系。

## 3. 多计算单元并行设计





